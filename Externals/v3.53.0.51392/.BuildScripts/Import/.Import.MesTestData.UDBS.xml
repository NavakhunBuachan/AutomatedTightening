<!--
This file can be imported into any project to add a conditional project reference, 
with the build configuration based on the .NET Framework and platform.

Example usage (update path relative to file containing the Import node):
	<Import Project=".Import.MesTestData.UDBS.xml" Condition="'$(ImportedMesTestDataUDBS)' != 'true'"/>
  
Dependency tree (top-down): FractalSteps - Fractal - MesTestData.Library - MesTestData.UDBS

Nested Dependencies: UdbsInterface, MesTestData.Interfaces - MesTestData.Models

Selection priority:
1. external source code, if '$(ReferenceSourceCode)' == 'true' AND source code exists
2. external binary, if exists. 
   - If $(ReferenceSourceCode), search bottom up; 
   - If not $(ReferenceSourceCode) or not found, search top-down in Externals of project
3. internal NuGet server, hosted at http://osatnugetserver.li.lumentuminc.net/nuget

By using a shared file, all projects are guaranteed to reference the same version,
and if we want to upgrade, only one file needs to be updated.
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <!-- Set Imported = true, to use as a condition to prevent multiple nested imports -->
    <ImportedMesTestDataUDBS>true</ImportedMesTestDataUDBS>
    <!-- Custom property to find the path of the external references for the project -->
    <!-- Default to "unknown" for not found -->
    <PathMesTestDataUdbs>unknown</PathMesTestDataUdbs>
  </PropertyGroup>
  <Choose>
    <!-- Note:  If more than one When element evaluates to true, only the first one is used -->
    <When Condition="'$(ReferenceSourceCode)' == 'true'">
      <!-- Search Source Code: Look from bottom to top -->
      <Choose>
        <!-- MesTestData.UDBS -->
        <!-- Project Source -->
        <When Condition="Exists('..\MesTestData.UDBS\MesTestData.UDBS.vbproj')">
          <ItemGroup>
            <ProjectReference Include="..\MesTestData.UDBS\MesTestData.UDBS.vbproj">
              <Project>{E65C42FC-FD62-47CF-A00B-4B7A1EA524EC}</Project>
              <Name>MesTestData.UDBS</Name>
            </ProjectReference>
          </ItemGroup>
          <!-- PathMesTestDataInterfaces N/A when using project reference from source -->
          <PropertyGroup>
            <PathMesTestDataUdbs>na</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <!-- MesTestData.UDBS -->
        <When Condition="Exists('Externals\MesTestData.UDBS')">
          <PropertyGroup>
            <PathMesTestDataUdbs>Externals\MesTestData.UDBS</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <!-- MesTestData.Library -->
        <When Condition="Exists('..\MesTestData.Library\Externals\MesTestData.UDBS')">
          <PropertyGroup>
            <PathMesTestDataUdbs>..\MesTestData.Library\Externals\MesTestData.UDBS</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <!-- Fractal -->
        <When Condition="Exists('..\Fractal\Externals\MesTestData.Library')">
          <PropertyGroup>
            <PathMesTestDataUdbs>..\Fractal\Externals\MesTestData.Library</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <!-- FractalSteps -->
        <When Condition="Exists('..\FractalSteps\Externals\Fractal')">
          <PropertyGroup>
            <PathMesTestDataUdbs>..\FractalSteps\Externals\Fractal</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
      </Choose>
    </When>
  </Choose>
  <!-- If path not found above, search External subfolders of project -->
  <Choose>
    <When Condition="'$(PathMesTestDataUdbs)' == 'unknown' And Exists('Externals')">
      <!-- Will get here if either not referencing source code, or the source code above was not found -->
      <!-- Look from top to bottom: FractalSteps - Fractal - MesTestData.Library - UdbsInterface / CamstarMes - MesTestData.Interfaces -->
      <Choose>
        <When Condition="Exists('Externals\FractalSteps')">
          <PropertyGroup>
            <PathMesTestDataUdbs>Externals\FractalSteps</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <When Condition="Exists('Externals\Fractal')">
          <PropertyGroup>
            <PathMesTestDataUdbs>Externals\Fractal</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <When Condition="Exists('Externals\MesTestData.Library')">
          <PropertyGroup>
            <PathMesTestDataUdbs>Externals\MesTestData.Library</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
        <When Condition="Exists('Externals\MesTestData.UDBS')">
          <PropertyGroup>
            <PathMesTestDataUdbs>Externals\MesTestData.UDBS</PathMesTestDataUdbs>
          </PropertyGroup>
        </When>
      </Choose>
    </When>
  </Choose>
  <!-- Add the external references, if path was found, else try the NuGet package reference -->
  <Choose>
    <When Condition="'$(PathMesTestDataUdbs)' == 'unknown'">
      <!-- Not found: use NuGet Package from http://osatnugetserver.li.lumentuminc.net/nuget -->
      <ItemGroup>
        <PackageReference Include="MesTestData.UDBS"/>
      </ItemGroup>
      <!-- Nested dependencies are included in the NuGet package -->
    </When>
    <Otherwise>
      <ItemGroup Condition="Exists('$(PathMesTestDataUdbs)')">
        <Reference Include="MesTestData.UDBS">
          <HintPath>$(PathMesTestDataUdbs)\$(BinSubfolder)\MesTestData.UDBS.dll</HintPath>
        </Reference>
      </ItemGroup>
    </Otherwise>
  </Choose>
  <ImportGroup Condition="'$(PathMesTestDataUdbs)' != 'unknown'">
    <!-- Import nested dependencies -->
    <Import Project=".Import.MesTestData.Interfaces.xml" Condition="'$(ImportedMesTestDataInterfaces)' != 'true'"/>
    <Import Project=".Import.UdbsInterface.xml" Condition="'$(ImportedUdbsInterface)' != 'true'"/>
  </ImportGroup>
</Project>