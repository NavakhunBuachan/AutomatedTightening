<!-- TODO: Add SRMInterface path 
This file can be imported into any project to add a conditional project reference, 
with the build configuration based on the .NET Framework and platform.

Example usage (update path relative to file containing the Import node):
	<Import Project=".BuildScripts\Import\.Import.JdsuFiles.xml" Condition="'$(ImportedJdsuFiles)' != 'true'"/>
  
Dependency tree (top-down): FractalSteps - Fractal - FractalHardwareSupport / MesTestData.Library  - UdbsInterface - SRMInterface - JdsuFiles

NOTE: May also be referenced through JdsuUdbsLibrary - UdbsInterface, but the solution would always include Fractal.  Always choose the Fractal path, as JdsuUdbsLibrary will soon be obsolete (Sept 2021)

Nested Dependencies: JdsuFiles

Selection priority:
1. external source code, if '$(ReferenceSourceCode)' == 'true' AND source code exists
2. external binary, if exists. 
   - If $(ReferenceSourceCode), search bottom up; 
   - If not $(ReferenceSourceCode) or not found, search top-down in Externals of project
3. internal NuGet server, hosted at http://osatnugetserver.li.lumentuminc.net/nuget

By using a shared file, all projects are guaranteed to reference the same version,
and if we want to upgrade, only one file needs to be updated.
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <!-- Set Imported = true, to use as a condition to prevent multiple nested imports -->
    <ImportedJdsuFiles>true</ImportedJdsuFiles>
    <!-- Custom property to find the path of the external references for the project -->
    <!-- Default to "unknown" for not found -->
    <PathJdsuFiles>unknown</PathJdsuFiles>
  </PropertyGroup>
  <!-- Search Source Code: Look from bottom to top -->
  <Choose>
    <!-- Project Source -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\JdsuFiles')">
      <ItemGroup>
        <ProjectReference Include="..\JdsuFiles\JdsuFiles.vbproj">
          <Project>{6E0113F9-CAB4-45C6-AA5D-D8F0F70B2958}</Project>
          <Name>JdsuFiles</Name>
        </ProjectReference>
      </ItemGroup>
      <!-- PathJdsuFiles N/A when using project reference from source -->
      <PropertyGroup>
        <PathJdsuFiles>na</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <!-- SRMInterface -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\SRMInterface\Externals\JdsuFiles')">
      <PropertyGroup>
        <PathJdsuFiles>..\SRMInterface\Externals\JdsuFiles</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <!-- UdbsInterface -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\UdbsInterface\Externals\SRMInterface')">
      <PropertyGroup>
        <PathJdsuFiles>..\UdbsInterface\Externals\SRMInterface</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <!-- FractalHardwareSupport -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalHardwareSupport\Externals\JdsuFiles')">
      <PropertyGroup>
        <PathJdsuFiles>..\FractalHardwareSupport\Externals\JdsuFiles</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <!-- Fractal -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\Fractal\Externals\FractalHardwareSupport')">
      <PropertyGroup>
        <PathJdsuFiles>..\Fractal\Externals\FractalHardwareSupport</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\Fractal\Externals\MesTestData.Library')">
      <PropertyGroup>
        <PathJdsuFiles>..\Fractal\Externals\MesTestData.Library</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <!-- FractalSteps -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalSteps\Externals\Fractal')">
      <PropertyGroup>
        <PathJdsuFiles>..\FractalSteps\Externals\Fractal</PathJdsuFiles>
      </PropertyGroup>
    </When>
  </Choose>
  <!-- Will get here if either not referencing source code, or the source code above was not found -->
  <!-- Look from top to bottom: FractalSteps - Fractal - FractalHardwareSupport / MesTestData.Library - UdbsInterface - SRMInterface - JdsuFiles-->
  <Choose>
    <When Condition="'$(PathJdsuFiles)' == 'unknown' And Exists('Externals\FractalSteps')">
      <PropertyGroup>
        <PathJdsuFiles>Externals\FractalSteps</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <When Condition="'$(PathJdsuFiles)' == 'unknown' And Exists('Externals\Fractal')">
      <PropertyGroup>
        <PathJdsuFiles>Externals\Fractal</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <When Condition="'$(PathJdsuFiles)' == 'unknown' And Exists('Externals\FractalHardwareSupport')">
      <PropertyGroup>
        <PathJdsuFiles>Externals\FractalHardwareSupport</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <When Condition="'$(PathJdsuFiles)' == 'unknown' And Exists('Externals\MesTestData.Library')">
      <PropertyGroup>
        <PathJdsuFiles>Externals\MesTestData.Library</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <When Condition="'$(PathJdsuFiles)' == 'unknown' And Exists('Externals\SRMInterface')">
      <PropertyGroup>
        <PathJdsuFiles>Externals\SRMInterface</PathJdsuFiles>
      </PropertyGroup>
    </When>
    <When Condition="'$(PathJdsuFiles)' == 'unknown' And Exists('Externals\JdsuFiles')">
      <PropertyGroup>
        <PathJdsuFiles>Externals\JdsuFiles</PathJdsuFiles>
      </PropertyGroup>
    </When>
  </Choose>
  <!-- Add the external references, if path was found, else try the NuGet package reference -->
  <Choose>
    <When Condition="'$(PathJdsuFiles)' == 'unknown'">
      <!-- Not found in externals: look for NuGet Package from http://osatnugetserver.li.lumentuminc.net/nuget -->
      <ItemGroup>
        <PackageReference Include="JdsuFiles"/>
      </ItemGroup>
    </When>
    <Otherwise>
      <ItemGroup Condition="Exists('$(PathJdsuFiles)')">
        <Reference Include="JdsuFiles">
          <HintPath>$(PathJdsuFiles)\$(BinSubfolder)\JdsuFiles.dll</HintPath>
        </Reference>
      </ItemGroup>
    </Otherwise>
  </Choose>
</Project>