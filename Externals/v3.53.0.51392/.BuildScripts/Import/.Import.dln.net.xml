<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Reference source code, if it exists, and the configuration is -source; 
  Otherwise, reference External binary files -->
  <Choose>
    <!-- Look in CommonLibrary Source External -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\CommonLibrary\Externals\Diolan\dln.net.dll')">
      <ItemGroup>
        <Reference Include="dln.net">
          <HintPath>..\CommonLibrary\Externals\Diolan\dln.net.dll</HintPath>
        </Reference>
      </ItemGroup>
    </When>
    <!-- Look in CommonLibrary Released binary -->
    <When Condition="'$(ReferenceSourceCode)' == 'false' And Exists('..\CommonLibrary\bin_version\$(BinSubfolder)\dln.net.dll')">
      <ItemGroup>
        <Reference Include="dln.net">
          <HintPath>..\CommonLibrary\bin_version\$(BinSubfolder)\dln.net.dll</HintPath>
        </Reference>
      </ItemGroup>
    </When>
    <!-- Use the reference directly from the external -->
    <When Condition="Exists('Externals\Diolan\dln.net.dll')">
      <ItemGroup>
        <Reference Include="dln.net">
          <HintPath>Externals\Diolan\dln.net.dll</HintPath>
        </Reference>
      </ItemGroup>
    </When>
    <!-- Look for installed Diolan driver -->
    <Otherwise>
      <ItemGroup>
        <Reference Include="dln.net">
          <HintPath>C:\Program Files\Diolan\DLN\binaries\dln.net.dll</HintPath>
        </Reference>
      </ItemGroup>
    </Otherwise>
  </Choose>
</Project>