<!--
This file can be imported into any project to add a conditional project reference, 
with the build configuration based on the .NET Framework and platform.

Example usage (update path relative to file containing the Import node):
 <Import Project=".BuildScripts\NuGet\MesTestData.Models.xml" />

Dependency tree (top-down): FractalSteps - Fractal - MesTestData.Library - UdbsInterface / CamstarMes - MesTestData.Interfaces - MesTestData.Models

Nested Dependencies: none

Selection priority:
1. external source code, if '$(ReferenceSourceCode)' == 'true' AND source code exists
2. external binary, if exists. 
   - If $(ReferenceSourceCode), search bottom up; 
   - If not $(ReferenceSourceCode) or not found, search top-down in Externals of project
3. internal NuGet server, hosted at http://osatnugetserver.li.lumentuminc.net/nuget

By using a shared file, all projects are guaranteed to reference the same version,
and if we want to upgrade, only one file needs to be updated.
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup>
		<!-- Custom property to find the path of the external references for the project -->
		<!-- Default to "unknown" for not found -->
		<PathMesTestDataModels>unknown</PathMesTestDataModels>
	</PropertyGroup>
	<Choose>
		<When Condition="'$(ReferenceSourceCode)' == 'true'">
			<!-- Search Source Code: Look from bottom to top -->
			<Choose>
				<!-- MesTestData.Models -->
				<When Condition="Exists('..\MesTestData.Models\MesTestData.Models.csproj')">
					<ItemGroup>
						<ProjectReference Include="..\MesTestData.Models\MesTestData.Models.csproj">
							<Project>{b8b4dec9-7a45-47b2-85e4-acafdb57cab6}</Project>
							<Name>MesTestData.Models</Name>
						</ProjectReference>
					</ItemGroup>
					<!-- PathMesTestDataModels N/A when using project reference from source -->
					<PropertyGroup>
						<PathMesTestDataModels>na</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<!-- MesTestData.Interfaces -->
				<When Condition="Exists('..\MesTestData.Interfaces\Externals\MesTestData.Models')">
					<PropertyGroup>
						<PathMesTestDataModels>..\MesTestData.Interfaces\Externals\MesTestData.Models</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<!-- CamstarMes -->
				<When Condition="Exists('..\CamstarMes\Externals\MesTestData.Interfaces')">
					<PropertyGroup>
						<PathMesTestDataModels>..\CamstarMes\Externals\MesTestData.Interfaces</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<!-- UdbsInterface -->
				<When Condition="Exists('..\UdbsInterface\Externals\MesTestData.Interfaces')">
					<PropertyGroup>
						<PathMesTestDataModels>..\UdbsInterface\Externals\MesTestData.Interfaces</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<!-- MesTestData.Library -->
				<When Condition="Exists('..\MesTestData.Library\Externals\MesTestData.CamstarMes')">
					<PropertyGroup>
						<PathMesTestDataModels>..\MesTestData.Library\Externals\MesTestData.CamstarMes</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('..\MesTestData.Library\Externals\UdbsInterface')">
					<PropertyGroup>
						<PathMesTestDataModels>..\MesTestData.Library\Externals\UdbsInterface</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<!-- Fractal -->
				<When Condition="Exists('..\Fractal\Externals\MesTestData.Library')">
					<PropertyGroup>
						<PathMesTestDataModels>..\Fractal\Externals\MesTestData.Library</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<!-- FractalSteps -->
				<When Condition="Exists('..\FractalSteps\Externals\Fractal')">
					<PropertyGroup>
						<PathMesTestDataModels>..\FractalSteps\Externals\Fractal</PathMesTestDataModels>
					</PropertyGroup>
				</When>
			</Choose>
		</When>
	</Choose>
	<!-- If path not found above, search External subfolders of project -->
	<Choose>
		<When Condition="'$(PathMesTestDataModels)' == 'unknown' And Exists('Externals')">
			<!-- Will get here if either not referencing source code, or the source code above was not found -->
			<!-- Look from top to bottom: FractalSteps - Fractal - MesTestData.Library - UdbsInterface / CamstarMes - MesTestData.Interfaces - MesTestData.Models -->
			<Choose>
				<When Condition="Exists('Externals\FractalSteps')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\FractalSteps</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\Fractal')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\Fractal</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.Library')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\MesTestData.Library</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\UdbsInterface')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\UdbsInterface</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.CamstarMes')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\MesTestData.CamstarMes</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.Interfaces')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\MesTestData.Interfaces</PathMesTestDataModels>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.Models')">
					<PropertyGroup>
						<PathMesTestDataModels>Externals\MesTestData.Models</PathMesTestDataModels>
					</PropertyGroup>
				</When>
			</Choose>
		</When>
	</Choose>
	<!-- Add the external references, if path was found, else try the NuGet package reference -->
	<Choose>
		<When Condition="'$(PathMesTestDataModels)' == 'na'">
			<!-- project source already added above -->
		</When>
		<When Condition="Exists('$(PathMesTestDataModels)')">
			<ItemGroup>
				<Reference Include="MesTestData.Models">
					<HintPath>$(PathMesTestDataModels)\$(BinSubfolder)\MesTestData.Models.dll</HintPath>
				</Reference>
			</ItemGroup>
		</When>
		<Otherwise>
			<!-- Not found: use NuGet Package from http://osatnugetserver.li.lumentuminc.net/nuget -->
			<ItemGroup>
				<PackageReference Include="MesTestData.Models" Version="1.1.*"/>
			</ItemGroup>
		</Otherwise>
	</Choose>
</Project>
