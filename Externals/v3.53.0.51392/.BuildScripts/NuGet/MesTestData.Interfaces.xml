<!--
This file can be imported into any project to add a conditional project reference, 
with the build configuration based on the .NET Framework and platform.

Example usage (update path relative to file containing the Import node):
	<Import Project=".BuildScripts\NuGet\MesTestData.Interfaces.xml" />
  
Dependency tree (top-down): FractalSteps - Fractal - MesTestData.Library  - UdbsInterface / CamstarMes - MesTestData.Interfaces 

NOTE: May also be referenced through JdsuUdbsLibrary - UdbsInterface, but the solution would always include Fractal.  Always choose the Fractal path, as JdsuUdbsLibrary will soon be obsolete (Sept 2021)

Nested Dependencies: MesTestData.Models

Selection priority:
1. external source code, if '$(ReferenceSourceCode)' == 'true' AND source code exists
2. external binary, if exists. 
   - If $(ReferenceSourceCode), search bottom up; 
   - If not $(ReferenceSourceCode) or not found, search top-down in Externals of project
3. internal NuGet server, hosted at http://osatnugetserver.li.lumentuminc.net/nuget

By using a shared file, all projects are guaranteed to reference the same version,
and if we want to upgrade, only one file needs to be updated.
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup>
		<!-- Custom property to find the path of the external references for the project -->
		<!-- Default to "unknown" for not found -->
		<PathMesTestDataInterfaces>unknown</PathMesTestDataInterfaces>
	</PropertyGroup>
	<Choose>
		<!-- Note:  If more than one When element evaluates to true, only the first one is used -->
		<When Condition="'$(ReferenceSourceCode)' == 'true'">
			<!-- Search Source Code: Look from bottom to top -->
			<Choose>
				<!-- MesTestData.Interfaces -->
				<!-- Project Source -->
				<When Condition="Exists('..\MesTestData.Interfaces\MesTestData.Interfaces.csproj')">
					<ItemGroup>
						<ProjectReference Include="..\MesTestData.Interfaces\MesTestData.Interfaces.csproj">
							<Project>{F7769E0D-F752-4F21-A5A5-C3B5682DCA92}</Project>
							<Name>MesTestData.Interfaces</Name>
						</ProjectReference>
					</ItemGroup>
					<!-- PathMesTestDataInterfaces N/A when using project reference from source -->
					<PropertyGroup>
						<PathMesTestDataInterfaces>na</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<!-- CamstarMes -->
				<When Condition="Exists('..\CamstarMes\Externals\MesTestData.Interfaces')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>..\CamstarMes\Externals\MesTestData.Interfaces</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<!-- UdbsInterface -->
				<When Condition="Exists('..\UdbsInterface\Externals\MesTestData.Interfaces')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>..\UdbsInterface\Externals\MesTestData.Interfaces</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<!-- MesTestData.Library -->
				<When Condition="Exists('..\MesTestData.Library\Externals\MesTestData.CamstarMes')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>..\MesTestData.Library\Externals\MesTestData.CamstarMes</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<When Condition="Exists('..\MesTestData.Library\Externals\UdbsInterface')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>..\MesTestData.Library\Externals\UdbsInterface</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<!-- Fractal -->
				<When Condition="Exists('..\Fractal\Externals\MesTestData.Library')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>..\Fractal\Externals\MesTestData.Library</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<!-- FractalSteps -->
				<When Condition="Exists('..\FractalSteps\Externals\Fractal')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>..\FractalSteps\Externals\Fractal</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
			</Choose>
		</When>
	</Choose>
	<!-- If path not found above, search External subfolders of project -->
	<Choose>
		<When Condition="'$(PathMesTestDataInterfaces)' == 'unknown' And Exists('Externals')">
			<!-- Will get here if either not referencing source code, or the source code above was not found -->
			<!-- Look from top to bottom: FractalSteps - Fractal - MesTestData.Library - UdbsInterface / CamstarMes - MesTestData.Interfaces -->
			<Choose>
				<When Condition="Exists('Externals\FractalSteps')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>Externals\FractalSteps</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\Fractal')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>Externals\Fractal</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.Library')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>Externals\MesTestData.Library</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\UdbsInterface')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>Externals\UdbsInterface</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.CamstarMes')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>Externals\MesTestData.CamstarMes</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
				<When Condition="Exists('Externals\MesTestData.Interfaces')">
					<PropertyGroup>
						<PathMesTestDataInterfaces>Externals\MesTestData.Interfaces</PathMesTestDataInterfaces>
					</PropertyGroup>
				</When>
			</Choose>
		</When>
	</Choose>
	<!-- Add the external references, if path was found, else try the NuGet package reference -->
	<Choose>
		<When Condition="'$(PathMesTestDataInterfaces)' == 'unknown'">
			<!-- Not found: use NuGet Package from http://osatnugetserver.li.lumentuminc.net/nuget -->
			<ItemGroup>
				<PackageReference Include="MesTestData.Interfaces"/>
			</ItemGroup>
		</When>
		<Otherwise>
			<ItemGroup Condition="Exists('$(PathMesTestDataInterfaces)')">
				<Reference Include="MesTestData.Interfaces">
					<HintPath>$(PathMesTestDataInterfaces)\$(BinSubfolder)\MesTestData.Interfaces.dll</HintPath>
				</Reference>
			</ItemGroup>
		</Otherwise>
	</Choose>
	<ImportGroup Condition="'$(PathMesTestDataInterfaces)' != 'unknown'">
		<!-- Import nested dependencies -->
		<Import Project="MesTestData.Models.xml"/>
	</ImportGroup>
</Project>