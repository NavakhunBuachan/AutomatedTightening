<!--
This file can be imported into any project to add a conditional project reference, 
with the build configuration based on the .NET Framework and platform.

Example usage (update path relative to file containing the Import node):
 <Import Project=".BuildScripts\Import\Import.JdsuTimingTools.xml" Condition="'$(ImportedJdsuTimingTools)' != 'true'" />

Dependency tree (top-down): FractalSteps - Fractal - FACE / FractalHardwareSupport / FractalStateMachine - ApplicationBase / FractalDataLibrary / FractalLanguage - FractalControlLibrary - JdsuTimingTools

Nested Dependencies: None

Selection priority:
1. external source code, if '$(ReferenceSourceCode)' == 'true' AND source code exists
2. external binary, if exists. 
   - If $(ReferenceSourceCode), search bottom up; 
   - If not $(ReferenceSourceCode) or not found, search top-down in Externals of project
3. (TODO) internal NuGet server, hosted at http://osatnugetserver.li.lumentuminc.net/nuget 

By using a shared file, all projects are guaranteed to reference the same version,
and if we want to upgrade, only one file needs to be updated.
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <!-- Set Imported = true, to use as a condition to prevent multiple nested imports -->
    <ImportedJdsuTimingTools>true</ImportedJdsuTimingTools>
    <!-- Custom property to find the path of the external references for the project -->
    <!-- Default to "unknown" for not found -->
    <PathJdsuTimingTools>unknown</PathJdsuTimingTools>
  </PropertyGroup>
  <!-- Search Source Code: Look from bottom to top -->
  <Choose>
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\JdsuTimingTools\JdsuTimingTools.vbproj')">
      <ItemGroup>
        <ProjectReference Include="..\JdsuTimingTools\JdsuTimingTools.vbproj">
          <Project>{87838aa2-b97a-46c9-8a36-f6ef895cc24e}</Project>
          <Name>JdsuTimingTools</Name>
        </ProjectReference>
      </ItemGroup>
      <!-- PathJdsuTimingTools N/A when using project reference from source -->
      <PropertyGroup>
        <PathJdsuTimingTools>na</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FractalControlLibrary -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalControlLibrary\Externals\JdsuTimingTools')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FractalControlLibrary\Externals\JdsuTimingTools</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- ApplicationBase / FractalDataLibrary / FractalLanguage -->
    <!-- ApplicationBase -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\ApplicationBase\Externals\FractalControlLibrary')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\ApplicationBase\Externals\FractalControlLibrary</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FractalDataLibrary -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalDataLibrary\Externals\FractalControlLibrary')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FractalDataLibrary\Externals\FractalControlLibrary</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FractalLanguage -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalLanguage\Externals\FractalControlLibrary')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FractalLanguage\Externals\FractalControlLibrary</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FACE / FractalHardwareSupport / FractalStateMachine -->
    <!-- FACE -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FACE\Externals\ApplicationBase')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FACE\Externals\ApplicationBase</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FractalHardwareSupport -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalHardwareSupport\Externals\FractalDataLibrary')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FractalHardwareSupport\Externals\FractalDataLibrary</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FractalStateMachine -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalStateMachine\Externals\FractalLanguage')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FractalStateMachine\Externals\FractalLanguage</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- Fractal -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\Fractal\Externals\FractalStateMachine')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\Fractal\Externals\FractalStateMachine</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- FractalSteps -->
    <When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalSteps\Externals\Fractal')">
      <PropertyGroup>
        <PathJdsuTimingTools>..\FractalSteps\Externals\Fractal</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <!-- If path not found above, search Externals subfolders of project -->
    <!-- Will get here if either not referencing source code, or the source code above was not found -->
    <!-- Look from top to bottom:  FractalSteps - Fractal - FACE / FractalHardwareSupport / FractalStateMachine - ApplicationBase / FractalDataLibrary / FractalLanguage - FractalControlLibrary - JdsuTimingTools -->
    <When Condition="Exists('Externals\FractalSteps')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FractalSteps</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\Fractal')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\Fractal</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\FractalStateMachine')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FractalStateMachine</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\FACE')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FACE</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\FractalHardwareSupport')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FractalHardwareSupport</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\FractalLanguage')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FractalLanguage</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\FractalDataLibrary')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FractalDataLibrary</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\ApplicationBase')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\ApplicationBase</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <When Condition="Exists('Externals\FractalControlLibrary')">
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\FractalControlLibrary</PathJdsuTimingTools>
      </PropertyGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <PathJdsuTimingTools>Externals\JdsuTimingTools</PathJdsuTimingTools>
      </PropertyGroup>
    </Otherwise>
  </Choose>
  <!-- Reference external path, if applicable. (N/A for project source reference above.) -->
  <ItemGroup Condition="Exists('$(PathJdsuTimingTools)')">
    <Reference Include="JdsuTimingTools">
      <HintPath>$(PathJdsuTimingTools)\$(BinSubfolder)\JdsuTimingTools.dll</HintPath>
    </Reference>
  </ItemGroup>
</Project>