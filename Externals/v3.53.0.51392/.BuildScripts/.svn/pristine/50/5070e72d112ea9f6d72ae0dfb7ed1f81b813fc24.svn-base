<!--
This file can be imported into any project to add a conditional project reference, 
with the build configuration based on the .NET Framework and platform.

Example usage (update path relative to file containing the Import node):
 <Import Project=".BuildScripts\Import\.Import.FractalControlLibrary.xml" Condition="'$(ImportedFractalControlLibrary)' != 'true'"/>

Dependency tree (top-down): FractalSteps - Fractal - FACE / FractalHardwareSupport / FractalStateMachine - ApplicationBase / FractalDataLibrary / FractalLanguage - FractalControlLibrary

Nested Dependencies: PDFViewer (NuGet), JdsuTimingTools

Selection priority:
1. external source code, if '$(ReferenceSourceCode)' == 'true' AND source code exists
2. external binary, if exists. 
	 - If $(ReferenceSourceCode), search bottom up; 
	 - If not $(ReferenceSourceCode) or not found, search top-down in Externals of project
3. (TODO) internal NuGet server, hosted at http://osatnugetserver.li.lumentuminc.net/nuget 

By using a shared file, all projects are guaranteed to reference the same version,
and if we want to upgrade, only one file needs to be updated.
-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup>
    <!-- Set Imported = true, to use as a condition to prevent multiple nested imports -->
    <ImportedFractalControlLibrary>true</ImportedFractalControlLibrary>
		<!-- Custom property to find the path of the external references for the project -->
		<!-- Default to "unknown" for not found -->
		<PathFractalControlLibrary>unknown</PathFractalControlLibrary>
	</PropertyGroup>
	<!-- Search Source Code: Look from bottom to top -->
	<Choose>
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalControlLibrary')">
			<ItemGroup>
				<ProjectReference Include="..\FractalControlLibrary\FractalControlLibrary.vbproj">
					<Project>{C9FB0897-694D-4395-975A-D781429094DC}</Project>
					<Name>FractalControlLibrary</Name>
				</ProjectReference>
			</ItemGroup>
			<!-- PathFractalControlLibrary N/A when using project reference from source -->
			<PropertyGroup>
				<PathFractalControlLibrary>na</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- ApplicationBase / FractalDataLibrary / FractalLanguage -->
		<!-- ApplicationBase -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\ApplicationBase\Externals\FractalControlLibrary')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\ApplicationBase\Externals\FractalControlLibrary</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- FractalDataLibrary -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalDataLibrary\Externals\FractalControlLibrary')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\FractalDataLibrary\Externals\FractalControlLibrary</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- FractalLanguage -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalLanguage\Externals\FractalControlLibrary')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\FractalLanguage\Externals\FractalControlLibrary</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- FACE / FractalHardwareSupport / FractalStateMachine -->
		<!-- FACE -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FACE\Externals\ApplicationBase')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\FACE\Externals\ApplicationBase</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- FractalHardwareSupport -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalHardwareSupport\Externals\FractalDataLibrary')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\FractalHardwareSupport\Externals\FractalDataLibrary</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- FractalStateMachine -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalStateMachine\Externals\FractalLanguage')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\FractalStateMachine\Externals\FractalLanguage</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- Fractal -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\Fractal\Externals\FractalStateMachine')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\Fractal\Externals\FractalStateMachine</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- FractalSteps -->
		<When Condition="'$(ReferenceSourceCode)' == 'true' And Exists('..\FractalSteps\Externals\Fractal')">
			<PropertyGroup>
				<PathFractalControlLibrary>..\FractalSteps\Externals\Fractal</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<!-- If path not found above, search Externals subfolders of project -->
		<!-- Will get here if either not referencing source code, or the source code above was not found -->
		<!-- Look from top to bottom:  FractalSteps - Fractal - FACE / FractalHardwareSupport / FractalStateMachine - ApplicationBase / FractalDataLibrary / FractalLanguage - FractalControlLibrary -->
		<When Condition="Exists('Externals\FractalSteps')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FractalSteps</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\Fractal')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\Fractal</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\FractalStateMachine')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FractalStateMachine</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\FACE')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FACE</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\FractalHardwareSupport')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FractalHardwareSupport</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\FractalLanguage')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FractalLanguage</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\FractalDataLibrary')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FractalDataLibrary</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<When Condition="Exists('Externals\ApplicationBase')">
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\ApplicationBase</PathFractalControlLibrary>
			</PropertyGroup>
		</When>
		<Otherwise>
			<PropertyGroup>
				<PathFractalControlLibrary>Externals\FractalControlLibrary</PathFractalControlLibrary>
			</PropertyGroup>
		</Otherwise>
	</Choose>	    
  <!-- Reference external path, if applicable. (N/A for project source reference above.) -->
  <ItemGroup Condition="Exists('$(PathFractalControlLibrary)')">
    <Reference Include="FractalControlLibrary">
      <HintPath>$(PathFractalControlLibrary)\$(BinSubfolder)\FractalControlLibrary.dll</HintPath>
    </Reference>
  </ItemGroup>  
	<!-- Import nested dependencies -->
	<Import Project="..\NuGet\PDFViewer.xml" Condition="'$(ImportedPDFViewer)' != 'true'"/>
	<Import Project=".Import.JdsuTimingTools.xml" Condition="'$(ImportedJdsuTimingTools)' != 'true'"/>
</Project>